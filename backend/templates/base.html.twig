<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>{% block title %}Functional Tester{% endblock %}</title>
  <script src="/js/boot-theme.js"></script>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" rel="stylesheet">
  <link href="/css/app.css?v={{ app.debug ? date().timestamp : '' }}" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/codemirror.min.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/addon/lint/lint.min.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/theme/dracula.min.css" crossorigin="anonymous" referrerpolicy="no-referrer" />
  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  {# moved styles to /css/app.css #}
</head>
<body>
<nav class="navbar navbar-expand-lg navbar-dark bg-dark mb-0">
  <div class="container-fluid">
    <a class="navbar-brand" href="{{ path('dashboard') }}">Functional Tester</a>
    <div class="ms-auto d-flex align-items-center">
      <button id="themeToggle" type="button" class="btn btn-sm btn-outline-light" aria-label="Basculer le mode sombre">Mode sombre</button>
      <button id="aiQuickTestBtn" type="button" class="btn btn-sm btn-outline-info ms-2" aria-label="Test IA simple">Test IA</button>
      <span id="aiQuickTestResult" class="ms-2 text-info small"></span>
    </div>
  </div>
</nav>
<main class="container-fluid py-3 fade-in">
  {% set current = app.request.attributes.get('_route') %}
  {% set bodyClass = app.user ? 'col-12 col-md-9 col-lg-10' : 'col-12' %}
  <div class="row">
    {% if app.user %}
      <aside class="col-12 col-md-3 col-lg-2 mb-3 mb-md-0">
        <div class="position-sticky sticky-top-1">
          <div class="list-group">
            <a href="{{ path('dashboard') }}" class="list-group-item list-group-item-action {{ current == 'dashboard' ? 'active' }}">Dashboard</a>
            <a href="{{ path('scenario_index') }}" class="list-group-item list-group-item-action {{ current starts with 'scenario_' ? 'active' }}">Scénarios</a>
            <a href="{{ path('scenario_new') }}" class="list-group-item list-group-item-action {{ current == 'scenario_new' ? 'active' }}">Nouveau scénario</a>
            <a href="{{ path('folder_index') }}" class="list-group-item list-group-item-action {{ current starts with 'folder_' ? 'active' }}">Dossiers</a>
            <a href="{{ path('unit_index') }}" class="list-group-item list-group-item-action {{ current starts with 'unit_' and current != 'unit_new' ? 'active' }}">Tests unitaires</a>
            <a href="{{ path('unit_new') }}" class="list-group-item list-group-item-action {{ current == 'unit_new' ? 'active' }}">Nouveau test unitaire</a>
            {% if is_granted('ROLE_ADMIN') %}
              <a href="{{ path('admin_users') }}" class="list-group-item list-group-item-action {{ current starts with 'admin_users' ? 'active' }}">Utilisateurs</a>
            {% endif %}
            <a href="{{ path('logout') }}" class="list-group-item list-group-item-action">Déconnexion</a>
          </div>
        </div>
      </aside>
    {% endif %}
    <section class="{{ bodyClass }}">
      {% block body %}{% endblock %}
    </section>
  </div>
</main>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/codemirror.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/mode/javascript/javascript.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/addon/edit/matchbrackets.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/addon/edit/closebrackets.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/addon/lint/lint.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jsonlint/1.6.0/jsonlint.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/addon/lint/json-lint.min.js"></script>
{# Cache-busting in dev to ensure latest JS loads #}
<script src="/js/app.js?v={{ app.debug ? date().timestamp : '' }}"></script>
<script src="/js/pages/scenario.js?v={{ app.debug ? date().timestamp : '' }}"></script>
<script src="/js/pages/unit.js?v={{ app.debug ? date().timestamp : '' }}"></script>
<script src="/js/ai-quick-test.js?v={{ app.debug ? date().timestamp : '' }}"></script>
</body>
</html>
