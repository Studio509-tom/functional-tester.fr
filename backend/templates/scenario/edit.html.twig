{% extends 'base.html.twig' %}
{% block title %}Éditer scénario{% endblock %}
{% block body %}
<h1>Éditer scénario</h1>
{{ form_start(form) }}
  <div class="row g-3 mb-3">
    <div class="col-12 col-md-6">
      <div class="mb-1">
        {{ form_label(form.name, 'Nom du scénario', {'label_attr': {'class': 'form-label'}}) }}
        <div class="input-group">
          <span class="input-group-text"><i class="bi bi-type"></i></span>
          {{ form_widget(form.name, { 'attr': {'class': (form.name.vars.attr.class|default('') ~ ' form-control form-control-lg')|trim, 'placeholder': 'Ex: Connexion client'} }) }}
        </div>
        {{ form_errors(form.name) }}
        <div class="form-text">Un nom clair pour retrouver rapidement ce scénario.</div>
      </div>
    </div>
    <div class="col-12 col-md-6">
      <div class="mb-1">
        {{ form_label(form.folder, 'Dossier', {'label_attr': {'class': 'form-label'}}) }}
        <div class="input-group">
          <span class="input-group-text"><i class="bi bi-folder2-open"></i></span>
          {{ form_widget(form.folder, { 'attr': {'class': (form.folder.vars.attr.class|default('') ~ ' form-select')|trim } }) }}
        </div>
        {{ form_errors(form.folder) }}
        <div class="form-text">Organisez vos scénarios par projet (optionnel).</div>
      </div>
    </div>
    <div class="col-12 col-md-6">
      <div class="mb-1">
        {{ form_label(form.baseUrl, 'Base URL', {'label_attr': {'class': 'form-label'}}) }}
        <div class="input-group">
          <span class="input-group-text"><i class="bi bi-globe2"></i></span>
          {{ form_widget(form.baseUrl, { 'attr': {'class': (form.baseUrl.vars.attr.class|default('') ~ ' form-control')|trim, 'placeholder': 'https://app.exemple.com'} }) }}
        </div>
        {{ form_errors(form.baseUrl) }}
        <div class="form-text">Préfixe pour les URL relatives des étapes <code>goto</code>.</div>
      </div>
    </div>
  </div>
  <div class="row g-3 mb-3">
    <div class="col-12">
      <h6 class="mt-2">Fiabilité et capture</h6>
    </div>
    <div class="col-12 col-md-6">
      <div class="form-check form-switch mb-2">
        {{ form_widget(form.perStepScreenshot, {'attr': {'class': 'form-check-input', 'role': 'switch', 'id': 'perStepScreenshot'}}) }}
        <label class="form-check-label" for="perStepScreenshot">{{ form.perStepScreenshot.vars.label }}</label>
      </div>
      <div class="form-check form-switch mb-2">
        {{ form_widget(form.screenshotFullPage, {'attr': {'class': 'form-check-input', 'role': 'switch', 'id': 'screenshotFullPage'}}) }}
        <label class="form-check-label" for="screenshotFullPage">{{ form.screenshotFullPage.vars.label }}</label>
      </div>
      <div class="row g-2">
        <div class="col-4">{{ form_row(form.retries) }}</div>
        <div class="col-4">{{ form_row(form.backoffMs) }}</div>
        <div class="col-4">{{ form_row(form.stepTimeoutMs) }}</div>
      </div>
    </div>
    <div class="col-12 col-md-6">
      <div class="mb-2">{{ form_row(form.deviceScaleFactor) }}</div>
      <div class="mb-2">{{ form_row(form.userAgent) }}</div>
      <div class="form-text">Astuce: 2x donne des PNG plus nets (fichier plus lourd). Laissez User-Agent vide pour la valeur par défaut (Chrome desktop).</div>
    </div>
  </div>
  <div class="row g-3 mb-3">
    <div class="col-12 col-md-6">
      <label class="form-label">Viewport (desktop)</label>
      <div class="input-group">
        <span class="input-group-text"><i class="bi bi-display"></i></span>
        <select class="form-select" id="viewportPreset" data-w-input-id="{{ form.viewportWidth.vars.id }}" data-h-input-id="{{ form.viewportHeight.vars.id }}">
          <option value="">Choisir un preset…</option>
          <option value="1366x768">1366 × 768</option>
          <option value="1920x1080">1920 × 1080</option>
          <option value="2560x1440">2560 × 1440</option>
          <option value="3840x2160">3840 × 2160</option>
        </select>
      </div>
      <div class="form-text">Sélectionner un preset remplit largeur/hauteur ci-dessous. Laissez vide pour la valeur par défaut.</div>
    </div>
    <div class="col-6 col-md-3">
      {{ form_label(form.viewportWidth, 'Largeur', {'label_attr': {'class': 'form-label'}}) }}
      {{ form_widget(form.viewportWidth, { 'attr': {'class': (form.viewportWidth.vars.attr.class|default('') ~ ' form-control')|trim, 'placeholder': 'ex: 1920'} }) }}
      {{ form_errors(form.viewportWidth) }}
    </div>
    <div class="col-6 col-md-3">
      {{ form_label(form.viewportHeight, 'Hauteur', {'label_attr': {'class': 'form-label'}}) }}
      {{ form_widget(form.viewportHeight, { 'attr': {'class': (form.viewportHeight.vars.attr.class|default('') ~ ' form-control')|trim, 'placeholder': 'ex: 1080'} }) }}
      {{ form_errors(form.viewportHeight) }}
    </div>
  </div>
  <div class="mb-3">
    <label class="form-label d-flex align-items-center justify-content-between">
      <span>Étapes</span>
      <button type="button" class="btn btn-sm btn-outline-primary" id="aiStepsBtn"><i class="bi bi-magic"></i> IA: suggérer des étapes</button>
    </label>
    <div class="form-text mb-2">Utilisez le constructeur visuel. Le JSON est géré automatiquement.</div>
    {{ form_widget(form.stepsJson, { attr: form.stepsJson.vars.attr|merge({'class': (form.stepsJson.vars.attr.class|default('') ~ ' d-none json-editor')|trim }) }) }}
  </div>
  <button class="btn btn-primary">Mettre à jour</button>
{{ form_end(form) }}
<div class="modal modal-overlay" tabindex="-1" id="aiStepsModal">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">IA: générer des étapes</h5>
        <button type="button" class="btn-close" id="aiStepsClose"></button>
      </div>
      <div class="modal-body">
        <label class="form-label">Décrivez le parcours utilisateur</label>
        <textarea id="aiStepsPrompt" class="form-control" rows="5" placeholder="Ex: Aller sur https://monapp.fr, cliquer sur Connexion, saisir email/mot de passe, valider, vérifier le titre du tableau de bord…"></textarea>
        <div class="form-text">Conseil: mentionnez les sélecteurs si possible (#id, .classe).</div>
        <div id="aiStepsError" class="text-danger small d-none mt-2"></div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" id="aiStepsCancel">Annuler</button>
        <button type="button" class="btn btn-primary" id="aiStepsGenerate">Générer</button>
      </div>
    </div>
  </div>
  </div>
{% endblock %}
